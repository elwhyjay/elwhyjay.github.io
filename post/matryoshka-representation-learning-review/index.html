<!DOCTYPE html>

<script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><style>
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 8px;
      font-size: 1.2rem;
      cursor: pointer;
      background: none;
      border: 1px solid ;
      border-color: black;
      border-radius: 60%;
      z-index: 1000;
    }
    body[a="dark"] .theme-toggle {
        border-color: white;
    }
</style>

<html lang="ko-kr"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="google-site-verification" content="CGHN0W7w6iWZ8ggs2E8eQ_Wiq1IuSxJHXr-KLZIetgk" />
   <meta name="description" content="blogë„ ê°œì„¤í•œê²¸ ë…¼ë¬¸í•œí¸ì„ ë¦¬ë·°í•´ë³´ê³ ì í•œë‹¤. ì •ë§ ì˜¤ëœë§Œì— ì‘ì„±í•˜ëŠ” ë¦¬ë·°ì´ë‹¤. ì´ ë…¼ë¬¸ì˜ ì œëª©ì€
Matryoshka Representation Learning ìœ¼ë¡œ Neurips&#39;22 ì— acceptëœ ë…¼ë¬¸ì´ë‹¤.
í•™ìŠµëœ representation (ì˜ˆë¥¼ ë“¤ì–´ encoderë¡œ embeddingëœ sentence ë“±)ì€ ë‹¤ì–‘í•œ ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ taskì— í™œìš©ëœë‹¤. Bert ê³„ì—´ì˜ encoderì˜ embeddingì¶œë ¥ê°’ì´ 768ì°¨ì›ìœ¼ë¡œ ê³ ì •ë˜ë“¯ ê° ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ taskì—ì„œ ê³ ì •ëœ í‘œí˜„ì€ ë¶€ì¡±í•˜ê±°ë‚˜ ê³¼í•  ìˆ˜ ìˆë‹¤. ì´ ë•Œ ì ì ˆí•œ ì°¨ì›ìœ¼ë¡œì˜ ì¶•ì†Œ ì—­ì‹œ ê·¸ í¬ê¸°ë¥¼ ì •í•˜ëŠ”ë° ë§ì€ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•´ì•¼ë§Œ í•œë‹¤. ì´ ë…¼ë¬¸ì€ ë§ˆíŠ¸ë£Œì‹œì¹´ í‘œí˜„ í•™ìŠµ ë°©ë²•(MRL)ì„ ì œì‹œí•¨ìœ¼ë¡œì¨ ì¸ì½”ë”ê°€ ë‹¤ì–‘í•œ ì •ë³´ë¡œ í‘œí˜„ì„ ì„ë² ë”©í•´ ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ taskì— ì ì‘í•˜ëŠ” ë°©ë²•ì„ ì œì‹œí•œë‹¤. MRLì„ í†µí•´ í•™ìŠµëœ í‘œí˜„ì€ ë‹¨ì¼ëª¨ë¸ë¡œ í•™ìŠµëœ ë™ì¼í•œ ì°¨ì›ì˜ í‘œí˜„ë§Œí¼ ì˜ í•™ìŠµí•œë‹¤.">  
  

  <title>
    
      Matryoshka Representation Learning Review
    
  </title>


  <link rel="shortcut icon" type="image/x-icon" href="/img/favicon.ico" />
  
  
  
  <link rel="stylesheet" href="/css/main.b27fc5610be205f24ca50ff0ec7c3029a919c277b959db7ed8b6e173d918decfc1435681e9a787476bce9650012878ff0a4ac9f8ac6f8e2ee2716f8eff5cead8.css" integrity="sha512-sn/FYQviBfJMpQ/w7HwwKakZwne5Wdt&#43;2Lbhc9kY3s/BQ1aB6aeHR2vOllABKHj/CkrJ&#43;Kxvji7icW&#43;O/1zq2A==" />
   <script>
  MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$','$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  };

  window.addEventListener('load', (event) => {
      document.querySelectorAll("mjx-container").forEach(function(x){
        x.parentElement.classList += 'has-jax'})
    });

</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
 
</head>
<style>
        table {
            border-collapse: collapse;
            border: 1px solid #ebebeb;
        }
        
        th, td {
            border: 1px solid #ffffff;
            padding: 8px;
        }
        th {
            background-color: #2290e5;
        }
        
    </style>
    
    <body a="auto">
        <button class="theme-toggle" onclick="toggleTheme()">
            <span class="light-icon">ğŸŒ</span>
            <span class="dark-icon" style="display:none">ğŸŒ™</span>
        </button>
        <main class="page-content" aria-label="Content">
            <div class="w">
<a href="/">..</a>


<article>
    <p class="post-meta">
        <time datetime="2024-09-27 00:00:29 &#43;0900 KST">
            2024-09-27
        </time>
    </p>

    <h1>Matryoshka Representation Learning Review</h1>

    

    <p>blogë„ ê°œì„¤í•œê²¸ ë…¼ë¬¸í•œí¸ì„ ë¦¬ë·°í•´ë³´ê³ ì í•œë‹¤. ì •ë§ ì˜¤ëœë§Œì— ì‘ì„±í•˜ëŠ” ë¦¬ë·°ì´ë‹¤. ì´ ë…¼ë¬¸ì˜ ì œëª©ì€
Matryoshka Representation Learning ìœ¼ë¡œ Neurips'22 ì— acceptëœ ë…¼ë¬¸ì´ë‹¤.</p>
<p>í•™ìŠµëœ representation (ì˜ˆë¥¼ ë“¤ì–´ encoderë¡œ embeddingëœ sentence ë“±)ì€ ë‹¤ì–‘í•œ ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ taskì— í™œìš©ëœë‹¤. Bert ê³„ì—´ì˜ encoderì˜ embeddingì¶œë ¥ê°’ì´ 768ì°¨ì›ìœ¼ë¡œ ê³ ì •ë˜ë“¯ ê° ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ taskì—ì„œ ê³ ì •ëœ í‘œí˜„ì€ ë¶€ì¡±í•˜ê±°ë‚˜ ê³¼í•  ìˆ˜ ìˆë‹¤. ì´ ë•Œ ì ì ˆí•œ ì°¨ì›ìœ¼ë¡œì˜ ì¶•ì†Œ ì—­ì‹œ ê·¸ í¬ê¸°ë¥¼ ì •í•˜ëŠ”ë° ë§ì€ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•´ì•¼ë§Œ í•œë‹¤. ì´ ë…¼ë¬¸ì€ ë§ˆíŠ¸ë£Œì‹œì¹´ í‘œí˜„ í•™ìŠµ ë°©ë²•(MRL)ì„ ì œì‹œí•¨ìœ¼ë¡œì¨ ì¸ì½”ë”ê°€ ë‹¤ì–‘í•œ ì •ë³´ë¡œ í‘œí˜„ì„ ì„ë² ë”©í•´ ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ taskì— ì ì‘í•˜ëŠ” ë°©ë²•ì„ ì œì‹œí•œë‹¤. MRLì„ í†µí•´ í•™ìŠµëœ í‘œí˜„ì€ ë‹¨ì¼ëª¨ë¸ë¡œ í•™ìŠµëœ ë™ì¼í•œ ì°¨ì›ì˜ í‘œí˜„ë§Œí¼ ì˜ í•™ìŠµí•œë‹¤.</p>
<p>ë°©ë²•ì€ ê°„ë‹¨í•˜ë‹¤. ê·¸ë¦¼ê³¼ ê°™ì´ ì„ë² ë”©ëœ $z$ì—ëŒ€í•´ $O(log(d))$ê°œì˜ ì„ë² ë”©ì„ ìƒì„±í•œë‹¤. ì´ë•Œ ë‹¨ìˆœíˆ ì›ë³¸ì„ë² ë”©ì„ ìë¥´ê¸°ë§Œí•œë‹¤. $z_{1:2},z_{1:4},z_{1:8} &hellip;
z_{1:d}$ ì˜ ì„ë² ë”©ë“¤ì— ëŒ€í•´ì„œ ê°ê° linear classifierë¥¼ íƒœìš°ê³  ë…ë¦½ì ìœ¼ë¡œ í•™ìŠµì‹œí‚¨ë‹¤. multi-class softmax cross entropy loss funcë¥¼ ì´ìš©í•´ lossë¥¼ êµ¬í•˜ê³  ëª¨ë“  lossë¥¼ í•©ì³ ëª¨ë¸ì„ ë™ì‹œì— í•™ìŠµì‹œí‚¨ë‹¤. ì´ê²Œ ì „ë¶€ì´ë‹¤. MRL-E (<em>Efficient - MRL</em>) ì€ linear classifierë¥¼ í•˜ë‚˜ë¡œ í•©ì¹œë‹¤. ì´ë•Œ $W \in \mathbb{R}^{L \times d}$ ëŠ” $z$ì˜ í¬ê¸°ì— ë§ì¶°ì§€ê³  $W_m = W_{1:m}$ ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆë‹¤. (ì´ ë°©ë²•ì´ ì •ë§ ë§ˆíŠ¸ë£Œì‹œì¹´ë‘ ë¹„ìŠ·í•œë“¯). ì¶”ê°€ë¡œ adpative classification, retrieval ê°™ì€ ë°©ë²•ì„ ì‚¬ìš©í•´ ë™ì ìœ¼ë¡œ í‘œí˜„ í¬ê¸°ë¥¼ ì¡°ì ˆ ê°€ëŠ¥í•˜ë‹¤ê³  í•œë‹¤.</p>
<p><img src="/img/Maytyoshka_img1.png" alt="figure1">*Figure 1 *</p>
<p>ë…¼ë¬¸ì€ ì£¼ë¡œ ë¹„ì ¼ taskì—ëŒ€í•´ì„œ ì‹¤í—˜í–ˆìŒìœ¼ë¡œ ìƒëµí•˜ê³  ì´ë¥¼ NLP ì— í™œìš©í•œ í›„ì† ë…¼ë¬¸ì¸ <strong><a href="https://arxiv.org/pdf/2402.14776v1">2D Matryoshka Sentence Embedding</a></strong> ë…¼ë¬¸ì„ ëŒ€ì¶© ì‚´í´ë³¸ë‹¤.</p>
<p>ì´ ë…¼ë¬¸ì€ íŠ¹íˆ transformerì˜ ëª¨ë“  layerì— ëŒ€í•´ MRLì„ ì ìš©í•œë‹¤. í•™ìŠµì‹œì— MRLê³¼ ë™ì¼í•˜ê²Œ ë§ˆì§€ë§‰ ì„ë² ë”©ì„ í•™ìŠµí•˜ê³ , ì¶”ê°€ë¡œ ë¬´ì‘ìœ„ë¡œ ì¤‘ê°„ ë ˆì´ì–´ë¥¼ ì„ íƒí•´ MRLì„ ì ìš©í•œë‹¤. ë˜ ë‘ ì„ë² ë”© lossì‚¬ì´ì˜ KL divergenceë¥¼ ì ìš©í•´ align ì„í•œë‹¤(ë¶„í¬ì°¨ì´ë¥¼ ì‘ê²Œí•¨). ì´ë ‡ê²Œ ì „ì²´ lossë¥¼ ë”í•´ ì´ lossë¡œ ëª¨ë¸ì„ í•™ìŠµí•˜ê²Œëœë‹¤. ë…¼ë¬¸ì—ì„œëŠ” MRLì²˜ëŸ¼ ëª¨ë“  trunc sizeë¥¼ í•™ìŠµí•˜ëŠ”ê²Œì•„ë‹ˆë¼ ì„ íƒëœ í¬ê¸°ë¡œ ì˜ë¼ì„œ ê·¸ ì°¨ì›ì˜ ì„ë² ë”©ë§Œ í•™ìŠµí•œë‹¤. ë˜í•œ ì—¬ê¸°ì„œ í•„ìš”ì— ë”°ë¼ ì–•ì€ ë ˆì´ì–´ì˜ ì„ë² ë”©ë§Œ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ inference ì†ë„ë¥¼ ë¹ ë¥´ê²Œ í•  ìˆ˜ ìˆë‹¤.</p>
<p><img src="/img/Maytyoshka_img2.png" alt="figure2"><em>Figure 2</em></p>
<h3 id="sentence-transformer-ì‚¬ìš©ë²•">Sentence Transformer ì‚¬ìš©ë²•</h3>
<p>sentence libraryì— êµ¬í˜„ì´ ë˜ì–´ìˆë‹¤. ì‚¬ìš©ë²•ì„ documentì—ì„œ ê°€ì ¸ì™€ë´¤ë‹¤.
í•™ìŠµì˜ ê²½ìš° ê°„ë‹¨íˆ lossë¥¼ ì„¤ì •í•´ì£¼ë©´ëœë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> sentence_transformers <span style="color:#f92672">import</span> SentenceTransformer
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sentence_transformers.losses <span style="color:#f92672">import</span> CoSENTLoss, MatryoshkaLoss
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> SentenceTransformer(<span style="color:#e6db74">&#34;microsoft/mpnet-base&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>base_loss <span style="color:#f92672">=</span> CoSENTLoss(model<span style="color:#f92672">=</span>model)
</span></span><span style="display:flex;"><span>loss <span style="color:#f92672">=</span> MatryoshkaLoss(model<span style="color:#f92672">=</span>model, loss<span style="color:#f92672">=</span>base_loss,
</span></span><span style="display:flex;"><span>                    matryoshka_dims<span style="color:#f92672">=</span>[<span style="color:#ae81ff">768</span>, <span style="color:#ae81ff">512</span>, <span style="color:#ae81ff">256</span>, <span style="color:#ae81ff">128</span>, <span style="color:#ae81ff">64</span>])
</span></span><span style="display:flex;"><span>loss <span style="color:#f92672">=</span> Matryoshka2dLoss(model<span style="color:#f92672">=</span>model, loss<span style="color:#f92672">=</span>base_loss,
</span></span><span style="display:flex;"><span>                    matryoshka_dims<span style="color:#f92672">=</span>[<span style="color:#ae81ff">768</span>, <span style="color:#ae81ff">512</span>, <span style="color:#ae81ff">256</span>, <span style="color:#ae81ff">128</span>, <span style="color:#ae81ff">64</span>])
</span></span></code></pre></div><p>inferenceëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> sentence_transformers <span style="color:#f92672">import</span> SentenceTransformer
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> torch.nn.functional <span style="color:#66d9ef">as</span> F
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>matryoshka_dim <span style="color:#f92672">=</span> <span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> SentenceTransformer(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;nomic-ai/nomic-embed-text-v1.5&#34;</span>,
</span></span><span style="display:flex;"><span>    trust_remote_code<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
</span></span><span style="display:flex;"><span>    truncate_dim<span style="color:#f92672">=</span>matryoshka_dim,
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>embeddings <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>encode(
</span></span><span style="display:flex;"><span>    [
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;search_query: What is TSNE?&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;search_document: t-distributed stochastic neighbor embedding (t-SNE) is a statistical method for visualizing high-dimensional data by giving each datapoint a location in a two or three-dimensional map.&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;search_document: Amelia Mary Earhart was an American aviation pioneer and writer.&#34;</span>,
</span></span><span style="display:flex;"><span>    ]
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">assert</span> embeddings<span style="color:#f92672">.</span>shape[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span> matryoshka_dim
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>similarities <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>similarity(embeddings[<span style="color:#ae81ff">0</span>], embeddings[<span style="color:#ae81ff">1</span>:])
</span></span><span style="display:flex;"><span><span style="color:#75715e"># =&gt; tensor([[0.7839, 0.4933]])</span>
</span></span></code></pre></div><p>ì‘ì€ ì‚¬ì´ì¦ˆì˜ ì„ë² ë”© í¬ê¸°ë¥¼ ì„¤ì •í•˜ì—¬ë„ search_query ì—ëŒ€í•´ì„œ ë¬´ê´€í•œ ë¬¸ì„œë³´ë‹¤ ìœ ê´€í•œ ë¬¸ì„œì˜ ìœ ì‚¬ì„±ì´ ë†’ê²Œ ë‚˜íƒ€ë‚¬ë‹¤.</p>
<p>GPT-4 turoboì—ë„ embedding ë°©ë²•ì„ í™œìš©í•˜ëŠ”ë“¯ í•˜ë‹¤.<a href="https://openai.com/index/new-embedding-models-and-api-updates/">^</a></p>
<hr>
<h1 id="reference">Reference</h1>
<ul>
<li>Kusupati, Aditya, et al. &ldquo;Matryoshka representation learning.&rdquo; Advances in Neural Information Processing Systems 35 (2022): 30233-30249. <a href="https://arxiv.org/pdf/2205.13147v4">https://arxiv.org/pdf/2205.13147v4</a></li>
<li><a href="https://github.com/RAIVNLab/MRL">https://github.com/RAIVNLab/MRL</a></li>
<li><a href="https://huggingface.co/blog/matryoshka">https://huggingface.co/blog/matryoshka</a></li>
<li>Li, Xianming, et al. &ldquo;2d matryoshka sentence embeddings.&rdquo; arXiv preprint arXiv:2402.14776 (2024).https://arxiv.org/pdf/2402.14776v1</li>
<li><a href="https://sbert.net/examples/training/matryoshka/README.html">https://sbert.net/examples/training/matryoshka/README.html</a></li>
<li><a href="https://velog.io/@hoon_lander/posts">https://velog.io/@hoon_lander/posts</a></li>
<li><a href="https://openai.com/index/new-embedding-models-and-api-updates/">https://openai.com/index/new-embedding-models-and-api-updates/</a></li>
</ul>
<hr>

</article>


    <script src="https://utteranc.es/client.js"
        repo="elwhyjay/blog-comment"
        issue-term="title"
        label="âœ¨ğŸ’¬âœ¨"
        theme="github-dark"
        crossorigin="anonymous"
        async>
</script>


            </div>
        </main>
        <script>
            function toggleTheme() {
              const body = document.querySelector('body');
              const currentTheme = body.getAttribute('a');
              const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
              
              body.setAttribute('a', newTheme);
              localStorage.setItem('theme', newTheme);
              
              
              const lightIcon = document.querySelector('.light-icon');
              const darkIcon = document.querySelector('.dark-icon');
              lightIcon.style.display = newTheme === 'dark' ? 'none' : 'inline';
              darkIcon.style.display = newTheme === 'dark' ? 'inline' : 'none';
            }
            
            
            document.addEventListener('DOMContentLoaded', () => {
              const savedTheme = localStorage.getItem('theme');
              if (savedTheme) {
                document.querySelector('body').setAttribute('a', savedTheme);
                
                const lightIcon = document.querySelector('.light-icon');
                const darkIcon = document.querySelector('.dark-icon');
                lightIcon.style.display = savedTheme === 'dark' ? 'none' : 'inline';
                darkIcon.style.display = savedTheme === 'dark' ? 'inline' : 'none';
              }
            });
        </script>
    </body>
</html>
